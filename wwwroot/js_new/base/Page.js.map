{"version":3,"file":"Page.js","sourceRoot":"","sources":["../../../base/Page.ts"],"names":[],"mappings":"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","sourcesContent":["import _BR from \"./_BR\";\r\nimport _Html from \"./_Html\";\r\nimport _Obj from \"./_Obj\";\r\nimport _Str from \"./_Str\";\r\nimport _Tool from \"./_Tool\";\r\nimport _Var from \"./_Var\";\r\n\r\ninterface IPageArg {\r\n\tpageNo: number;\r\n\tpageRows: number;\r\n\tfilterRows: number;\r\n}\r\n\r\n/**\r\n * pagin component, config has properties:\r\n * pageStr {string} json string from backend(pageNo,pageRows,filterRows)\r\n * pager {object} jquery page object\r\n * linker {object} (optional) link object, if empty\r\n * action {string} action url\r\n * showMenu {bool} (default false) show page menu or not(select page rows)\r\n * pageRowList {array} (default [10,25,50,100]) page menu item list\r\n * onFind {function} (optional) callback for get input json\r\n * return {Page}\r\n */ \r\nexport default class Page {\r\n\r\n\t//get from input parameters\r\n\tprivate pager: any; // jquery page object\r\n\tprivate linker: any; // link object\r\n\tprivate action: string;\r\n\tprivate showMenu: boolean;\r\n\tprivate pageRowList: number[];\r\n\t//private onFind: Function | undefined; // 儲存於 config 中，僅傳遞給 _init 和 find\r\n\tprivate pageArg!: IPageArg; // Initialized in _init\r\n\r\n\tconstructor(config: any) {\r\n\r\n\t\t//get from input parameters\r\n\t\tthis.pager = config.pager;\r\n\t\tthis.linker = config.linker;\r\n\t\tthis.action = config.action;\r\n\t\tthis.showMenu = config.showMenu || _Var.notEmpty(config.pageRowList);\r\n\t\tthis.pageRowList = config.pageRowList || [10, 25, 50, 100];\r\n\t\t//this.onFind = config.onFind;\r\n\t\t//this.noRowMsg = noRowMsg || _BR.FindNone;\r\n\r\n\t\t//call last\r\n\t\tthis._init(config.pageStr, config.onFind);\r\n\t}\r\n\r\n\t//initial\r\n\tprivate _init(pageStr: string, onFind: Function): void {\r\n\t\t//has: pageNo, pageRows, filterRows\r\n\t\tthis.pageArg = this._getPageArg(pageStr);\r\n\t\tconst arg = this.pageArg;\r\n\t\tconst pager = this.pager;\r\n\t\tif (arg.filterRows <= 0) {\r\n\t\t\t_Obj.hide(pager);\r\n\t\t\t_Tool.msg(_BR.FindNone);\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\t/*\r\n\t\t//const count = this.pager.length == 0 ? 0 : parseInt(this.pager.data('count'));\r\n\t\tif (arg.filterRows <= arg.pageRows) {\r\n\t\t\tif (arg.filterRows == 0)\r\n\t\t\t\tpager.html('<div class=\"-info\">' + noRowMsg + '</div>')\r\n\t\t\t//pager.hide();\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t*/\r\n\r\n\t\t//set rows menu if need\r\n\t\tlet menu = '';\r\n\t\tif (this.showMenu) {\r\n\t\t\t//const tpl = \"每頁顯示 _Menu @@筆, 第 _Start 至 _End 筆, 總共 _Total 筆\";\r\n\t\t\tconst cols = _BR.Page.split('@@');\r\n\t\t\tmenu = cols[0].replace('_Menu', this._getMenuHtml());\r\n\r\n\t\t\tconst start = (arg.pageNo - 1) * arg.pageRows + 1;\r\n\t\t\tconst end = start + arg.pageRows - 1;\r\n\t\t\tconst info = cols[1]\r\n\t\t\t\t.replace('_Start', start)\r\n\t\t\t\t.replace('_End', end <= arg.filterRows ? end : arg.filterRows)\r\n\t\t\t\t.replace('_Total', arg.filterRows);\r\n\t\t\tmenu = _Str.format(\r\n\t\t\t\t\"<div class='x-page-menu'>\" +\r\n\t\t\t\t\t\"<label>{0}<span>{1}</span></label>\" +\r\n\t\t\t\t\"</div>\", menu, info);\r\n\t\t}\r\n\r\n\t\t//set html\r\n\t\t//pager.addClass('row');\t//for layout\r\n\t\tpager.html(menu + \"<div class='x-page-btns'></div>\");\r\n\r\n\t\t//register onchange event, this did not work inside !!\r\n\t\tpager.find('select').change(function () {\r\n\t\t\tonFind();\r\n\t\t});\r\n\r\n\t\t//initial simplePagin\r\n\t\tpager.find('.x-page-btns').pagination({\r\n\t\t\tcurrentPage: arg.pageNo,\r\n\t\t\titemsOnPage: arg.pageRows,\r\n\t\t\titems: arg.filterRows,\r\n\t\t\t//displayedPages: 3,\r\n\t\t\tlistStyle: 'pagination ' + (this.showMenu ? 'x-has-menu' : 'x-no-menu'),\r\n\t\t\tprevText: \"<\",\r\n\t\t\tnextText: \">\",\r\n\t\t\t//prevText: \"<i class='fas fa-chevron-left'></i>\",\r\n\t\t\t//nextText: \"<i class='fas fa-chevron-right'></i>\",\r\n\t\t\tonPageClick: onFind,\r\n\t\t});\r\n\t}\r\n\r\n\tprivate _getMenuHtml(): string {\r\n\t\tlet menu = \"<select class='form-select x-inline x-w100'>\";\r\n\t\tfor (let i = 0; i < this.pageRowList.length; i++) {\r\n\t\t\tmenu += _Str.format(\"<option value='{0}'{1}>{0}</option>\", this.pageRowList[i],\r\n\t\t\t\tthis.pageArg.pageRows == this.pageRowList[i] ? ' selected' : '');\r\n\t\t}\r\n\t\tmenu += \"</select>\";\r\n\t\treturn menu;\r\n\t}\r\n\r\n\t//pageArg has 3 property: pageNo, pageRows, filterRows\r\n\tprivate _getPageArg(pageStr: string): IPageArg {\r\n\t\tconst json = JSON.parse(_Html.decode(pageStr));\r\n\t\tif (json['pageNo'] == null)\r\n\t\t\tjson['pageNo'] = 1;\r\n\t\tif (json['pageRows'] == null)\r\n\t\t\tjson['pageRows'] = 0;\r\n\t\tif (json['filterRows'] == null)\r\n\t\t\tjson['filterRows'] = -1;\r\n\t\treturn json as IPageArg;\r\n\t}\r\n\r\n\t/**\r\n\t * public method for find rows\r\n\t * param url {string} action url\r\n\t * param json {json} query json\r\n\t * param page {int} page no\r\n\t */\r\n\tpublic find(json: any, page: number | undefined): void {\r\n\t\tjson = json || {};\r\n\t\tconst arg = this.pageArg;\r\n\t\tif (_Var.isEmpty(page)) {\r\n\t\t\targ.pageNo = 1;\r\n\t\t\targ.filterRows = -1;\r\n\t\t\targ.pageRows = this.pager.find('select').val();\r\n\t\t} else {\r\n\t\t\targ.pageNo = page;\r\n\t\t}\r\n\r\n\t\tlet url = this.action +\r\n\t\t\t'?page=' + arg.pageNo +\r\n\t\t\t'&rows=' + arg.pageRows +\r\n\t\t\t'&filter=' + arg.filterRows;\r\n\t\tfor (const key in json) {\r\n\t\t\tif (_Str.notEmpty(json[key]))\r\n\t\t\t\turl += '&' + key + '=' + json[key];\r\n\t\t}\r\n\r\n\t\tconst linker = this.linker;\r\n\t\tif (_Obj.isEmpty(linker)) {\r\n\t\t\twindow.location.href = url;\r\n\t\t} else {\r\n\t\t\tlinker.attr('href', url);\r\n\t\t\tlinker.trigger('click');\r\n        }\r\n\t}\r\n}"]}