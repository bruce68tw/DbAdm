{"version":3,"file":"_ISelect.js","sourceRoot":"","sources":["../../../base/_ISelect.ts"],"names":[],"mappings":"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","sourcesContent":["import _IBase from \"./_IBase\";\r\nimport _Obj from \"./_Obj\";\r\nimport _Str from \"./_Str\";\r\nimport _Ajax from \"./_Ajax\";\r\n\r\n//select option \r\nexport default class _ISelect extends _IBase {\r\n\r\n    //#region override\r\n    public static getO(obj: JQuery): string {\r\n        return (obj.length === 0) ? '' : obj.find('option:selected').val() as string;\r\n    }\r\n\r\n    public static setO(obj: JQuery, value: string): JQuery | null {\r\n        const filter = 'option[value=\"' + value + '\"]';\r\n        const item = obj.find(filter);\r\n        if (item.length > 0) {\r\n            item.prop('selected', true);\r\n            return item;\r\n        } else {\r\n            //remove selected\r\n            obj.find('option:selected').prop('selected', false);\r\n            return null;\r\n        }\r\n    }\r\n\r\n    public static setEditO(obj: JQuery, status: boolean): void {\r\n        obj.prop('disabled', !status);\r\n    }\r\n    //#endregion\r\n\r\n    //get selected index(base 0)\r\n    public static getIndex(fid: string, box: JQuery): number {\r\n        return _ISelect.getIndexO(_Obj.get(fid, box));\r\n    }\r\n    public static getIndexO(obj: JQuery): number {\r\n        return obj.prop('selectedIndex') as number;\r\n    }\r\n\r\n    //get options count\r\n    public static getCount(fid: string, box: JQuery): number {\r\n        return _ISelect.getCountO(_Obj.get(fid, box));\r\n    }\r\n    public static getCountO(obj: JQuery): number {\r\n        return obj.find('option').length;\r\n    }\r\n\r\n    //set by index(base 0)\r\n    public static setIndex(fid: string, idx: number, box: JQuery): void {\r\n        _ISelect.setIndexO(_Obj.get(fid, box), idx);\r\n    }\r\n    public static setIndexO(obj: JQuery, idx: number): void {\r\n        obj.find('option').eq(idx).prop('selected', true);\r\n    }\r\n\r\n    //傳回選取的欄位的文字\r\n    public static getText(fid: string, box: JQuery): string {\r\n        const obj = _Obj.get(fid, box);\r\n        return _ISelect.getTextO(obj);\r\n    }\r\n    public static getTextO(obj: JQuery): string {\r\n        return obj.find('option:selected').text();\r\n    }\r\n\r\n    //傳回data屬性(name)值\r\n    public static getData(fid: string, name: string, box: JQuery): any {\r\n        return _Obj.get(fid, box).find('option:selected').data(name);\r\n    }\r\n    public static getDataO(obj: JQuery, name: string): any {\r\n        return obj.find('option:selected').data(name);\r\n    }\r\n\r\n    //重新設定option內容\r\n    //items: 來源array, 欄位為:Id,Str\r\n    public static setItems(fid: string, items: { Id: string, Str: string }[] | null, box: JQuery): void {\r\n        const obj = _Obj.get(fid, box);\r\n        _ISelect.setItemsO(obj, items);\r\n    }\r\n    public static setItemsF(filter: string, items: { Id: string, Str: string }[] | null, box: JQuery): void {\r\n        const obj = _Obj.getF(filter, box);\r\n        _ISelect.setItemsO(obj, items);\r\n    }\r\n    //by object\r\n    public static setItemsO(obj: JQuery, items: { Id: string, Str: string }[] | null): void {\r\n        obj.find('option').remove();\r\n        if (items === null)\r\n            return;\r\n\r\n        for (let i = 0; i < items.length; i++)\r\n            obj.append($('<option></option>').attr('value', items[i].Id).text(items[i].Str));\r\n    }\r\n\r\n    //get all options\r\n    //getIdStrExts -> getExts\r\n    public static getExts(fid: string, box: JQuery): { Id: string, Str: string, Ext: string }[] {\r\n        const rows: { Id: string, Str: string, Ext: string }[] = [];\r\n        _Obj.get(fid, box).find('option').each(function (i) {\r\n            const me = $(this);\r\n            rows[i] = {\r\n                Id: me.val() as string,\r\n                Str: me.text(),\r\n                Ext: me.data('ext') as string,\r\n            };\r\n        });\r\n        return rows;\r\n    }\r\n\r\n    //重新設定option內容, 欄位為:Id,Str,Ext\r\n    //setItems2 -> setExts\r\n    public static setExts(fid: string, items: { Id: string, Str: string, Ext: string }[] | null, box: JQuery): void {\r\n        const filter = '#' + fid;\r\n        const obj = box ? box.find(filter) : $(filter);\r\n        obj.find('option').remove();\r\n        if (items == null)\r\n            return;\r\n        for (let i = 0; i < items.length; i++)\r\n            obj.append(_Str.format(\"<option data-ext='{0}' value='{1}'>{2}</option>\", items[i].Ext, items[i].Id, items[i].Str));\r\n    }\r\n\r\n    //把多欄位值寫入json\r\n    //fids: 欄位名稱 array\r\n    public static valuesToJson(json: { [key: string]: any }, fids: string[], box: JQuery): { [key: string]: any } {\r\n        for (let i = 0; i < fids.length; i++)\r\n            json[fids[i]] = _ISelect.get(fids[i], box);\r\n        return json;\r\n    }\r\n\r\n    //ie 不支援 option display:none !!\r\n    //filter options by data-ext value\r\n    //rows: 所有option 資料(Id,Text,Ext)\r\n    public static filterByExt(fid: string, value: string, rows: { Id: string, Str: string, Ext: string }[], box: JQuery, allItem?: boolean, addEmptyStr?: string): void {\r\n        if (allItem === undefined)\r\n            allItem = false;\r\n        const obj = _Obj.get(fid, box);\r\n        obj.empty();\r\n\r\n        if (addEmptyStr !== undefined && addEmptyStr !== '')\r\n            obj.append(_Str.format('<option value=\"\">{0}</option>', addEmptyStr));\r\n\r\n        //item.find('option').hide();\r\n        const len = rows.length;\r\n        for (let i = 0; i < len; i++) {\r\n            const row = rows[i];\r\n            //if (row.Ext == value)\r\n            if ((allItem === true && row.Ext === '') || row.Ext === value)\r\n                obj.append(_Str.format('<option value=\"{0}\">{1}</option>', row.Id, row.Str));\r\n        }\r\n\r\n        //選取第0筆\r\n        if (len > 0)\r\n            _ISelect.setIndexO(obj, 0);\r\n    }\r\n\r\n    /**\r\n     * onChangeParent -> changeParent\r\n     * 處理2個下拉欄位的連動, 例如:城市-鄉鎮, parent欄位改變時, child欄位的內容也改變\r\n     * param parentFid {stirng} parent欄位Id\r\n     * param childFid {stirng} child欄位Id\r\n     * param childId {stirng} child欄位值, 如果空白表示不設定此欄位值(只更新來源)\r\n     * param action {stirng} 後端action讀取來源, 固定傳入parentId\r\n     * param isEdit {bool} true(編輯畫面), false(查詢畫面)\r\n     */\r\n    public static changeParent(parentFid: string, childFid: string, childId: string, action: string, isEdit: boolean): void {\r\n        // 假設 _me, _ajax 在其他地方有定義或引入，這裡因為原始程式碼沒有提供，所以需要根據實際情況調整\r\n        // 為了編譯通過，暫時將 _me.divEdit 和 _me.divRead 假設為 JQuery 類型\r\n        const _me: { divEdit: JQuery, divRead: JQuery } = { divEdit: $({}), divRead: $({}) }; // 模擬 _me 物件\r\n        const box = isEdit ? _me.divEdit : _me.divRead;\r\n        const thisId = _ISelect.get(parentFid, box);\r\n        _Ajax.getJsonA(action, { parentId: thisId }, (rows: { Id: string, Str: string }[]) => {\r\n            _ISelect.setItems(childFid, rows, box);\r\n            if (_Str.notEmpty(childId)) {\r\n                _ISelect.set(childFid, childId, box);\r\n            }\r\n        });\r\n    }\r\n\r\n} //class"]}