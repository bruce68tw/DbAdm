{"version":3,"file":"_Edit.js","sourceRoot":"","sources":["../../../../base/services/_Edit.ts"],"names":[],"mappings":"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","sourcesContent":["import _Input from \"./_Input\";\r\n\r\n/**\r\n * 許多函數在初始化執行, 所以無法放在CrudE.js\r\n * only for CrudE.js, EditOne.js, EditMany.js !!\r\n * 內容為: \r\n * 1.靜態 constant\r\n * 2.初始化函數\r\n * 3.get/set old value\r\n * 4.判斷是否為新資料 & 處理\r\n */ \r\nexport default class _Edit {\r\n\r\n    //constant with underline\r\n    static readonly Rows: string = '_rows';\r\n    static readonly Childs: string = '_childs';\r\n    static readonly Deletes: string = '_deletes';\r\n\r\n    //server side fid for file input collection, must pre '_'\r\n    //key-value of file serverFid vs row key\r\n    static readonly FileJson: string = '_fileJson';\r\n\r\n    //data property name for keep old value\r\n    static readonly DataOld: string = '_old';\r\n\r\n    //前後端欄位: isNew, new row flag\r\n    static readonly IsNew: string = '_IsNew';\r\n\r\n    //edit form mode\r\n    static readonly ModeBase: string = 'Base';\r\n    static readonly ModeUR: string = 'UR';   //user role mode\r\n\r\n\r\n    /**\r\n     * 初始化變數\r\n     * setFidTypeVars + setFileVars -> initVars\r\n     * set fid-type variables: fidTypes, fidTypeLen\r\n     * param me {object} EditOne/EditMany object\r\n     * param box {object} container (jQuery object)\r\n     * return void\r\n     */\r\n    static initVars(me: any, box: JQuery): void {\r\n        //set fid-type variables: fidTypes, fidTypeLen\r\n        const fidTypes: (string | undefined)[] = [];\r\n        box.find(_Input.fidFilter()).each(function (i, item) {\r\n            const obj = $(item);\r\n            const j = i * 2;\r\n            fidTypes[j] = _Input.getFid(obj);\r\n            fidTypes[j + 1] = _Input.getType(obj);\r\n        });\r\n        me.fidTypes = fidTypes;\r\n        me.fidTypeLen = me.fidTypes.length;\r\n\r\n        //set file related variables: fileFids, fileLen, hasFile\r\n        me.fileFids = [];      //upload file fid array\r\n        box.find('[data-type=file]').each(function (index, item) {\r\n            me.fileFids[index] = _Input.getFid($(item));\r\n        });\r\n        me.fileLen = me.fileFids.length;\r\n        me.hasFile = me.fileFids.length > 0; //has input file or not\r\n    }\r\n\r\n    /**\r\n     * get old value \r\n     * param obj {object} input jquery object\r\n     * return {string | undefined}\r\n     */ \r\n    static getOld(obj: JQuery): string | undefined {\r\n        return obj.data(_Edit.DataOld);\r\n    }\r\n\r\n    /**\r\n     * set old value\r\n     * param obj {object} input jquery object\r\n     * param value {number | string}\r\n     */ \r\n    static setOld(obj: JQuery, value: number | string): void {\r\n        obj.data(_Edit.DataOld, value);\r\n    }\r\n\r\n    /**\r\n     * isNewKey(key) -> isNewRow(row)\r\n     * check a new key or not, parseInt(ABC123) will get int, cannot use it!!\r\n     * param row {object}\r\n     * return {boolean}\r\n     */\r\n    static isNewRow(row: any): boolean {\r\n        const fid = _Edit.IsNew;\r\n        // Check if the value is not null AND is not '0' (assuming '0' or null means false/old, and '1' or presence means true/new)\r\n        return (row[fid] != null && row[fid] != '0');\r\n    }\r\n\r\n    /**\r\n     * 增加隱藏欄位 _IsNew, 同時設為1\r\n     * param box {JQuery} jquery object\r\n     */\r\n    static addIsNew(box: JQuery): void {\r\n        const fid = _Edit.IsNew;\r\n        let field = box.find(_Input.fidFilter(fid));\r\n        \r\n        if (field.length === 0) {\r\n            // TypeScript/jQuery note: append returns the box object, not the appended element.\r\n            box.append(`<input type=\"hidden\" data-fid=\"${fid}\" name=\"${fid}\" value=\"1\" >`);\r\n            // We need to re-find the element if we want to work with 'field' after appending\r\n            field = box.find(_Input.fidFilter(fid));\r\n        } else {\r\n            field.val('1');\r\n        }\r\n    }\r\n\r\n    /**\r\n     * 刪除隱藏欄位 _IsNew\r\n     * param box {JQuery} jquery object\r\n     */\r\n    static removeIsNew(box: JQuery): void {\r\n        const fid = _Edit.IsNew;\r\n        const field = box.find(_Input.fidFilter(fid));\r\n        if (field.length > 0)\r\n            field.remove();\r\n    }\r\n\r\n    /**\r\n     * getServerFid -> getFileSid\r\n     * get server side variables name for file field\r\n     * param levelStr {string} \r\n     * param fid {string} ui file id\r\n     * return {string} format: t[levelStr]_[fid]\r\n    static getFileSid(levelStr: string, fid: string): string {\r\n        return 't' + levelStr + '_' + fid;\r\n    }\r\n     */\r\n\r\n} //class"]}