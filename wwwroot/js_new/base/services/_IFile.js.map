{"version":3,"file":"_IFile.js","sourceRoot":"","sources":["../../../../base/services/_IFile.ts"],"names":[],"mappings":"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","sourcesContent":["// @ts-nocheck\r\nimport _BR from \"./_BR\"; // Assuming _BR is a resource object\r\nimport _File from \"./_File\";\r\nimport _Fun from \"./_Fun\";\r\nimport _IBase from \"./_IBase\";\r\nimport _Obj from \"./_Obj\";\r\nimport _Str from \"./_Str\";\r\nimport _Tool from \"./_Tool\";\r\n\r\n/**\r\n * //input file\r\n */\r\nexport default class _IFile extends _IBase {\r\n\r\n    //object: file input\r\n\r\n    //=== overwrite start ===\r\n    /**\r\n     * get border object\r\n     * param obj {object} input object\r\n     */\r\n    static getBorder(obj: JQuery): JQuery {\r\n        return obj.prev();\r\n    }\r\n\r\n    static setO(obj: JQuery, value: string): void {\r\n        obj.val(value);     //set hidden input value\r\n        _IFile._elmToLink(obj).text(value);  //set link show text\r\n    }\r\n    //=== overwrite end ===\r\n\r\n    /**\r\n     * formData add file for upload, called by EditOne/EditMany.js\r\n     * param data {formData}\r\n     * param fid {string} file field id\r\n     * param serverFid {string} server side variable name\r\n     * param box {object} form/row object\r\n     * return {boolean} has file or not\r\n     */\r\n    static dataAddFile(data: FormData, fid: string, serverFid: string, box: JQuery): boolean {\r\n        const obj = _Obj.get(fid, box);\r\n        const file = _IFile.getUploadFile(_IFile._elmToFile(obj));\r\n        const hasFile = (file != null);\r\n        if (hasFile)\r\n            data.append(serverFid, file);\r\n        return hasFile;\r\n    }\r\n\r\n    //=== event start ===\r\n    static onOpenFile(): void {\r\n        const btn = _Fun.getMe();\r\n        const file = _IFile._elmToFile(btn);\r\n        file.focus().trigger('click'); //focus first !!\r\n    }\r\n\r\n    //file: input element\r\n    static onChangeFile(): void {\r\n        //case of empty file\r\n        const file = _Fun.getMe() as HTMLInputElement;\r\n        const obj = _IFile._elmToObj(file);\r\n        const fileObj = $(file);\r\n        const value = file.value; //full path\r\n        if (_Str.isEmpty(value)) {\r\n            _IFile.setO(obj, '');\r\n            return;\r\n        }\r\n\r\n        //check file ext\r\n        let exts = (fileObj.data('exts') as string).toLowerCase();\r\n        if (_Str.notEmpty(exts) && exts !== '*') {\r\n            const ext = _File.getFileExt(value);\r\n            exts = ',' + exts + ',';\r\n            if (exts.indexOf(',' + ext + ',') < 0) {\r\n                _Tool.msg(_BR.UploadFileNotMatch);\r\n                file.value = '';\r\n                return;\r\n            }\r\n        }\r\n\r\n        //check file size\r\n        const max = fileObj.data('max') as number;\r\n        if (file.files && file.files[0] && file.files[0].size > max * 1024 * 1024) {\r\n            _Tool.msg(_Str.format(_BR.UploadFileNotBig, max));\r\n            file.value = '';\r\n            return;\r\n        }\r\n\r\n        //case ok\r\n        _IFile.setO(obj, _File.getFileName(value));\r\n    }\r\n\r\n    static onDeleteFile(): void {\r\n        const btn = _Fun.getMe();\r\n        _IFile.setO(_IFile._elmToObj(btn), '');\r\n    }\r\n    //=== event end ===\r\n\r\n    //?? initial after load rows\r\n    static zz_init(fid: string, path: string, form: JQuery): void {\r\n        const fileObj = _Obj.get(fid, form);\r\n        fileObj.val('');\r\n        //_ifile.setFun(fileObj, ''); //set fun to empty\r\n        //_ifile.setPathByFile(fileObj, path);\r\n\r\n        /*\r\n        //file element Ë¶Å reset\r\n        var file = _obj.getF(_ifile.fileF(id), form);\r\n        //var $el = $('#example-file');\r\n        file.wrap('<form>').closest('form').get(0).reset();\r\n        file.unwrap();\r\n        */\r\n    }\r\n\r\n\r\n    //=== private function below ===\r\n    /**\r\n     * element to file box object\r\n     * param elm {element}\r\n     * return {object} file box object\r\n     */\r\n    static _elmToBox(elm: Elm): JQuery {\r\n        return $(elm).closest('.xi-box');\r\n    }\r\n    //get file object\r\n    static _elmToFile(elm: Elm): JQuery {\r\n        return _IFile._boxGetFile(_IFile._elmToBox(elm));\r\n    }\r\n    //get input object\r\n    static _elmToObj(elm: Elm): JQuery {\r\n        return _IFile._boxGetObj(_IFile._elmToBox(elm));\r\n    }\r\n    //get link object\r\n    static _elmToLink(elm: Elm): JQuery {\r\n        return _IFile._boxGetLink(_IFile._elmToBox(elm));\r\n    }\r\n\r\n    /**\r\n     * box get link object\r\n     * param box {object} box object\r\n     */\r\n    static _boxGetLink(box: JQuery): JQuery {\r\n        //return box.find('a');\r\n        return box.find('a').last();\r\n    }\r\n    static _boxGetFile(box: JQuery): JQuery {\r\n        return box.find(':file');\r\n    }\r\n    //box get input object\r\n    static _boxGetObj(box: JQuery): JQuery {\r\n        return box.find('[data-type=file]');\r\n    }\r\n\r\n    //border get uploaded file, return null if empty\r\n    static getUploadFile(fileObj: JQuery): File | null {\r\n        if (fileObj.length == 0)\r\n            return null;\r\n\r\n        // The input element (HTMLInputElement)\r\n        const inputElement = fileObj.get(0) as HTMLInputElement;\r\n\r\n        // Check for files property and its length\r\n        if (inputElement.files && inputElement.files.length > 0) {\r\n            return inputElement.files[0];\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n} //class"]}