{"version":3,"file":"_Valid.js","sourceRoot":"","sources":["../../../../base/services/_Valid.ts"],"names":[],"mappings":"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","sourcesContent":["//import \"jquery.validation\";\r\nimport _Input from \"./_Input\";\r\nimport _Obj from \"./_Obj\";\r\nimport _Str from \"./_Str\";\r\n\r\n//use jquery validation\r\nexport default class _Valid {\r\n\r\n    //error & valid class same to jquer validate\r\n    //errorClass: 'error',\r\n    //validClass: 'valid',\r\n\r\n    /**\r\n     * initial jQuery Validation\r\n     * param form {JQuery} form object\r\n     * return {JQuery.Validator} validator object\r\n     */\r\n    static init(form: JQuery): JQueryValidation.Validator {\r\n        //remove data first\r\n        form.removeData('validator');\r\n\r\n        //config\r\n        const config: JQueryValidation.ValidationOptions = {\r\n            /*\r\n            */\r\n            //errorClass: 'label label-danger',\r\n            //onclick: false, //checkbox, radio, and select\r\n            //ignore: ':hidden:not(.xd-valid[data-type=file]),:hidden:not([data-type=html]),.note-editable.card-block',   //or summernote got error\r\n            //ignore: ':hidden:not(.xd-valid)',     //html/file has .xd-valid need validate !!\r\n            ignore: ':hidden:not(.xd-valid), .note-editable.panel-body',\r\n            errorElement: 'span',\r\n            errorPlacement: function (error: JQuery, elm: JQuery) {\r\n                error.insertAfter(_Valid._getBox(elm));\r\n                return false;\r\n            },\r\n            //顯示validation錯誤\r\n            highlight: function (elm: Elm, errorClass: string, validClass: string) {\r\n                const me = $(elm);\r\n                const box = _Valid._getBox(me);\r\n                box.removeClass(validClass).addClass(errorClass);\r\n                const errObj = _Valid._getError(me);\r\n                if (errObj != null)\r\n                    _Obj.show(errObj);\r\n                return false;\r\n            },\r\n            //清除validation錯誤\r\n            unhighlight: function (elm: Elm, errorClass: string, validClass: string) {\r\n                const me = $(elm);\r\n                const box = _Valid._getBox(me);\r\n                box.removeClass(errorClass).addClass(validClass);\r\n                const errObj = _Valid._getError(me);\r\n                if (errObj != null)\r\n                    _Obj.hide(errObj);\r\n                return false;\r\n            },\r\n            /*\r\n            //copy from jquery validate defaultShowErrors()\r\n            showErrors: function (errorMap, errorList) {\r\n                //this.defaultShowErrors();\r\n                var i, elements, error;\r\n                for (i = 0; this.errorList[i]; i++) {\r\n                    error = this.errorList[i];\r\n                    if (this.settings.highlight) {\r\n                        this.settings.highlight.call(this, error.element, this.settings.errorClass, this.settings.validClass);\r\n                    }\r\n                    this.showLabel(error.element, error.message);\r\n                }\r\n                if (this.errorList.length) {\r\n                    this.toShow = this.toShow.add(this.containers);\r\n                }\r\n                if (this.settings.success) {\r\n                    for (i = 0; this.successList[i]; i++) {\r\n                        this.showLabel(this.successList[i]);\r\n                    }\r\n                }\r\n                if (this.settings.unhighlight) {\r\n                    for (i = 0, elements = this.validElements(); elements[i]; i++) {\r\n                        this.settings.unhighlight.call(this, elements[i], this.settings.errorClass, this.settings.validClass);\r\n                    }\r\n                }\r\n                //remark below !!\r\n                //this.toHide = this.toHide.not(this.toShow);\r\n                //this.hideErrors();\r\n                //this.addWrapper(this.toShow).show();\r\n                //return false;\r\n            },\r\n            */\r\n        };\r\n\r\n        // 假設 jQuery.fn.validate() 存在並返回 JQuery.Validator\r\n        return form.validate(config) as JQueryValidation.Validator;\r\n    }\r\n\r\n    /**\r\n     * 使用 jquery validation方式顯示錯誤, 通知由後端傳回錯誤, 再前端顯示\r\n     * param fid{string} field id\r\n     * param msg{string} error msg\r\n     * param eform id{string} (optional for 多筆) 若為多筆則必須配合rowId找到fid\r\n     * param rowId{string} (optional for 多筆) row Id valud\r\n     */\r\n    // 注意: 原始JS代碼中，_me.eform0 是一個未定義的外部變數，這裡假設它可以在 TS 環境中被訪問或替換為一個 JQuery\r\n    static showError(fid: string, msg: string, eformId: StrN = null, rowId: StrN = null): void {\r\n        let eform: any; // JQuery | undefined\r\n        eform = _Str.isEmpty(eformId) ? _me.eform0 : $('#' + eformId);\r\n\r\n        /*\r\n        var input;\r\n        if (_str.isEmpty(rowId)) {\r\n            input = eform.find(_input.fidFilter(fid));\r\n        } else {\r\n            //多筆??\r\n        }\r\n        */\r\n\r\n        // 必須確保 eform 是有效的 JQuery 物件且已初始化 validator\r\n        if (eform && eform.validator) {\r\n            eform.validator.showErrors({\r\n                [fid]: msg\r\n            });\r\n        }\r\n    }\r\n\r\n    private static _getBox(obj: JQuery): JQuery {\r\n        //closest will check this first !!\r\n        return obj.closest('.xi-box');\r\n    }\r\n\r\n    /**\r\n     * get error object\r\n     * param obj {object} input object\r\n     */\r\n    private static _getError(obj: JQuery): JQueryN {\r\n        const error = _Valid._getBox(obj).next();\r\n        return (error.length === 1 && error.hasClass('error') && error.is('span'))\r\n            ? error : null;\r\n    }\r\n\r\n    /*\r\n    valid: function () {\r\n        var valid, validator, errorList;\r\n\r\n        if ($(this[0]).is(\"form\")) {\r\n            valid = this.validate().form();\r\n        } else {\r\n            errorList = [];\r\n            valid = true;\r\n            validator = $(this[0].form).validate();\r\n            this.each(function () {\r\n                valid = validator.element(this) && valid;\r\n                if (!valid) {\r\n                    errorList = errorList.concat(validator.errorList);\r\n                }\r\n            });\r\n            validator.errorList = errorList;\r\n        }\r\n        return valid;\r\n    },\r\n    */\r\n\r\n    //#region remark code\r\n    /**\r\n     * check regular\r\n     * param fids {array} fid string array\r\n     * param msg {string} error message\r\n     * param expr {regular} regular expression\r\n     * return {bool}\r\n    anyRegularsWrong: function (fids, msg, expr) {\r\n        if (fids == null || fids.length == 0)\r\n            return false;\r\n\r\n        //var expr = /^(([^<>()\\[\\]\\\\.,;:\\s@\"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\r\n        var find = false;\r\n        for (var i = 0; i < fids.length; i++) {\r\n            var value = $('#' + fids[i]).val();\r\n            if (!expr.test(value)) {\r\n                find = true;\r\n                _input.showError(fids[i], msg);\r\n            }\r\n        }\r\n        return find;\r\n    },\r\n     */\r\n\r\n    /**\r\n     * check email \r\n     * see : http://stackoverflow.com/questions/46155/validate-email-address-in-javascript\r\n     * params\r\n     * data : email address\r\n     * return : true/false\r\n    anyEmailsWrong: function (fids, msg) {\r\n        var expr = /^(([^<>()\\[\\]\\\\.,;:\\s@\"]+(\\.[^<>()\\[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\r\n        return _valid.anyRegularsWrong(fids, msg, expr);\r\n    },\r\n     */\r\n\r\n    /**\r\n     * check address\r\n     * params\r\n     * data : address\r\n     * return : true/false\r\n    anyAddressesWrong: function (fids, msg) {\r\n        var expr = /^\\d+\\w*\\s*(?:(?:[\\-\\/]?\\s*)?\\d*(?:\\s*\\d+\\/\\s*)?\\d+)?\\s+/;\r\n        return _valid.anyRegularsWrong(fids, msg, expr);\r\n    },\r\n     */\r\n    //#endregion\r\n\r\n} //class"]}