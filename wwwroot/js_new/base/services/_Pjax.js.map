{"version":3,"file":"_Pjax.js","sourceRoot":"","sources":["../../../../base/services/_Pjax.ts"],"names":[],"mappings":"AAAA,OAAO,aAAa,CAAC;AACrB,OAAO,KAAK,MAAM,SAAS,CAAC;AAC5B,OAAO,SAAS,MAAM,aAAa,CAAC;AACpC,OAAO,KAAK,MAAM,SAAS,CAAC;AAC5B,OAAO,IAAI,MAAM,QAAQ,CAAC;AAE1B,UAAU;AACV,MAAM,CAAC,OAAO,OAAO,KAAK;IAEtB;;;OAGG;IACH,MAAM,CAAC,IAAI,CAAC,KAAa;QACrB,0CAA0C;QAC1C,MAAM,IAAI,GAAG,CAAC,CAAC,QAAQ,CAAC,CAAC;QACzB,6EAA6E;QAC7E,IAAI,CAAC,IAAI,CAAC,aAAa,EAAE,KAAK,EAAE,EAAE,IAAI,EAAE,MAAM,EAAE,CAAC,CAAC;QAElD,eAAe;QACf,IAAI,CAAC,EAAE,CAAC,OAAO,EAAE,yBAAyB,EAAE;YACxC,MAAM,QAAQ,GAAG,SAAS,CAAC,WAAW,CAAC,CAAC,CAAC,IAAI,CAAC,CAAC,CAAC;YAChD,KAAK,CAAC,aAAa,CAAC,QAAQ,CAAC,CAAC;QAClC,CAAC,CAAC,CAAC;QAET;;;;;;;UAOE;QAEI,gCAAgC;QAChC,IAAI,CAAC,EAAE,CAAC,cAAc,EAAE,UAAU,KAAU,EAAE,IAAY,EAAE,MAAc,EAAE,GAAc,EAAE,IAAS;YACjG,MAAM,IAAI,GAAG,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,CAAC;YAC/B,IAAI,IAAI,IAAI,IAAI,EAAE,CAAC;gBACf,iCAAiC;gBACjC,MAAM,MAAM,GAAG,KAAK,CAAC,cAAc,CAAC,IAAI,CAAC,CAAC;gBAC1C,IAAI,MAAM,EAAE,CAAC;oBACT,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC;gBACnC,CAAC;YACL,CAAC;QACL,CAAC,CAAC,CAAC;QAEH,wBAAwB;QACxB,IAAI,CAAC,EAAE,CAAC,YAAY,EAAE,UAAU,KAAU,EAAE,GAAc,EAAE,UAAkB,EAAE,WAAmB,EAAE,IAAS;YAC1G,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,YAAY,EAAE,UAAU,EAAE,GAAG,CAAC,CAAC;YAChD,OAAO,KAAK,CAAC;QACjB,CAAC,CAAC,CAAC;QAEH,mBAAmB;QACnB,gBAAgB;QAChB,WAAW;QACX,8EAA8E;QAC9E,mBAAmB;QACnB,iBAAiB;QACjB,QAAQ;QACR,QAAQ;QACR,6DAA6D;QAC7D,kDAAkD;QAClD,iBAAiB;QACjB,8EAA8E;QAC9E,SAAS;QACT,QAAQ;QACR,8CAA8C;QAC9C,iBAAiB;QAEjB,sCAAsC;QACtC,SAAS;QACT,QAAQ;QAER,kCAAkC;QAClC,iBAAiB;QACjB,mDAAmD;QAEnD,+CAA+C;QAC/C,qCAAqC;QACrC,6BAA6B;QAC7B,KAAK;QAEL;;;;;;;UAOE;QAEF,sBAAsB;QACtB,+DAA+D;QAC/D,yBAAyB;QACzB,mBAAmB;QACnB,QAAQ;QACR,yBAAyB;QACzB,qCAAqC;QACrC,iCAAiC;QACjC,qDAAqD;QACrD,OAAO;QAEP,iDAAiD;QACjD,mCAAmC;QACnC,uCAAuC;QACvC,iCAAiC;QACjC,8DAA8D;QAC9D,8DAA8D;QAC9D,mDAAmD;QACnD,kDAAkD;QAClD,qCAAqC;QACrC,gCAAgC;QAChC,6DAA6D;QAC7D,OAAO;QAEP,iBAAiB;QACjB,kCAAkC;QAClC,+FAA+F;QAC/F,8BAA8B;QAC9B,+CAA+C;QAC/C,6BAA6B;QAC7B,aAAa;QACb,OAAO;QACP,QAAQ;QACR,KAAK;IACT,CAAC;CAEJ;AAAA,CAAC,CAAA,OAAO","sourcesContent":["import 'jquery-pjax';\r\nimport _Ajax from \"./_Ajax\";\r\nimport _Leftmenu from \"./_Leftmenu\";\r\nimport _Prog from \"./_Prog\";\r\nimport _Str from \"./_Str\";\r\n\r\n//SPA pjax\r\nexport default class _Pjax {\r\n\r\n    /**\r\n     * initial\r\n     * param {string} boxFt : box(container) filter\r\n     */\r\n    static init(boxFt: string): void {\r\n        //if skip 'POST', it will trigger twice !!\r\n        const docu = $(document);\r\n        // Assuming $.fn.pjax is available via a definition file or installed typings\r\n        docu.pjax('[data-pjax]', boxFt, { type: 'POST' });\r\n\r\n        //點擊功能項目時記錄功能名稱\r\n        docu.on('click', '.x-leftmenu [data-pjax]', function () {\r\n            const menuPath = _Leftmenu.getMenuPath($(this));\r\n            _Prog.storeProgPath(menuPath);\r\n        });\r\n\r\n\t\t/*\r\n        //PJAX請求前\r\n        docu.on('pjax:beforeSend', function (event: any, xhr: JQueryXHR, opts: any) {\r\n            // Assuming _fun.jwtToken is on a class named _Fun\r\n            if (_Fun.jwtToken)\r\n                xhr.setRequestHeader('Authorization', `Bearer ${_Fun.jwtToken}`);\r\n        });\r\n\t\t*/\r\n\t\t\r\n        //'data' 是後端回傳字串, 可能為 HTML 或錯誤訊息\r\n        docu.on('pjax:success', function (event: any, data: string, status: string, xhr: JQueryXHR, opts: any) {\r\n            const json = _Str.toJson(data);\r\n            if (json != null) {\r\n                //只顯示錯誤訊息, 不處理欄位 validation error\r\n                const errMsg = _Ajax.resultToErrMsg(json);\r\n                if (errMsg) {\r\n                    $(opts.container).html(errMsg);\r\n                }\r\n            }\r\n        });\r\n\r\n        //when backend exception\r\n        docu.on('pjax:error', function (event: any, xhr: JQueryXHR, textStatus: string, errorThrown: string, opts: any) {\r\n            opts.success(xhr.responseText, textStatus, xhr);\r\n            return false;\r\n        });\r\n\r\n        //選擇性 binding event\r\n        //xd-bind 只有用在這裡\r\n        //debugger;\r\n        //$('[data-pjax]:not(.xd-bind)').addClass('xd-bind').on('click', function () {\r\n        //    //post submit\r\n        //    //debugger;\r\n        //    /*\r\n        //    */\r\n        //    $(document).on('ready pjax:success', box, function () {\r\n        //        //bindPJAX(target); // Call initializers\r\n        //        init();\r\n        //        $(document).off('ready pjax:success', box); // Unbind initialization\r\n        //    });\r\n        //    /*\r\n        //    $(document).on('pjax:end', function () {\r\n        //        init();\r\n\r\n        //        $(document).off('pjax:end');\r\n        //    });\r\n        //    */\r\n\r\n        //    // PJAX-load the new content\r\n        //    //debugger;\r\n        //    //$.pjax.click(event, { container: $(box) });\r\n\r\n        //    //var path = _pjax._getPath($(this), '');\r\n        //    var url = $(this).data('pjax');\r\n        //    _Pjax.submit(url, box);\r\n        //});\r\n\r\n        /*\r\n        //如果後端驗証失敗, 則取消 submit\r\n        $(document).on('pjax:beforeReplace', function (contents, options) {\r\n        });\r\n        $(document).on('pjax:end', function (data, status, xhr) {\r\n            init();\r\n        });\r\n        */\r\n\r\n        //pjax載入完成後必須程式載入.js檔案\r\n        //$(document).on('pjax:success', function (data, status, xhr) {\r\n        //    //_me.initByPjax();\r\n        //    //_me.init();\r\n        //    /*\r\n        //    //先載入 JsLib if need\r\n        //    var jsLib = $('#_JsLib').val();\r\n        //    if (_Str.notEmpty(jsLib)) {\r\n        //        $.getScript('../Scripts/' + jsLib + '.js');\r\n        //    }\r\n\r\n        //    //如果view包含_JsView這個hidden欄位, 則表示要載入指定的js檔案,\r\n        //    //否則載入與controller相同名稱的js file\r\n        //    var jsView = $('#_JsView').val();\r\n        //    if (_Str.isEmpty(jsView)) {\r\n        //        //get controller name, 在倒數第2個, js檔案名稱固定為controller小寫\r\n        //        var url = data.currentTarget.URL.replace('//', '/');\r\n        //        if (url.substr(url.length - 1, 1) == '/')\r\n        //            url = url.substr(0, url.length - 1);\r\n        //        var items = url.split('/');\r\n        //        if (items.length >= 4)\r\n        //            jsView = items[items.length - 2].toLowerCase();\r\n        //    }\r\n\r\n        //    //載入 jsView\r\n        //    if (_Str.notEmpty(jsView)) {\r\n        //        $.getScript('../Scripts/view/' + jsView + '.js', function (data, textStatus, jqxhr) {\r\n        //            //載入成功後執行 init()\r\n        //            if (typeof (_me) !== 'undefined')\r\n        //                _me.init();\r\n        //        });\r\n        //    }\r\n        //    */\r\n        //});\r\n    }\r\n\r\n};//class"]}