{"version":3,"file":"_ISelect.js","sourceRoot":"","sources":["../../../../base/services/_ISelect.ts"],"names":[],"mappings":"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","sourcesContent":["import _IBase from \"./_IBase\";\r\nimport _Obj from \"./_Obj\";\r\nimport _Str from \"./_Str\";\r\nimport _Ajax from \"./_Ajax\";\r\n\r\n//select option \r\nexport default class _ISelect extends _IBase {\r\n\r\n    //#region override\r\n    static getO(obj: JQueryN): string {\r\n        return _Obj.isEmpty(obj) ? '' : obj!.find('option:selected').val() as string;\r\n    }\r\n\r\n    static setO(obj: JQueryN, value: string): JQueryN {\r\n        if (_Obj.isEmpty(obj)) return null;\r\n\r\n        const filter = 'option[value=\"' + value + '\"]';\r\n        const item = obj!.find(filter);\r\n        if (item.length > 0) {\r\n            item.prop('selected', true);\r\n            return item;\r\n        } else {\r\n            //remove selected\r\n            obj!.find('option:selected').prop('selected', false);\r\n            return null;\r\n        }\r\n    }\r\n\r\n    static setEditO(obj: JQueryN, status: boolean): void {\r\n        if (_Obj.isEmpty(obj)) return;\r\n        obj!.prop('disabled', !status);\r\n    }\r\n    //#endregion\r\n\r\n    //get selected index(base 0)\r\n    static getIndex(fid: string, box: JQuery): number {\r\n        return _ISelect.getIndexO(_Obj.get(fid, box));\r\n    }\r\n    static getIndexO(obj: JQueryN): number {\r\n        if (_Obj.isEmpty(obj)) return -1;\r\n        return obj!.prop('selectedIndex') as number;\r\n    }\r\n\r\n    //get options count\r\n    static getCount(fid: string, box: JQuery): number {\r\n        return _ISelect.getCountO(_Obj.get(fid, box));\r\n    }\r\n    static getCountO(obj: JQueryN): number {\r\n        if (_Obj.isEmpty(obj)) return -1;\r\n        return obj!.find('option').length;\r\n    }\r\n\r\n    //set by index(base 0)\r\n    static setIndex(fid: string, idx: number, box: JQuery): void {\r\n        _ISelect.setIndexO(_Obj.get(fid, box)!, idx);\r\n    }\r\n    static setIndexO(obj: JQueryN, idx: number): void {\r\n        if (_Obj.isEmpty(obj)) return;\r\n        obj!.find('option').eq(idx).prop('selected', true);\r\n    }\r\n\r\n    //傳回選取的欄位的文字\r\n    static getText(fid: string, box: JQuery): string {\r\n        const obj = _Obj.get(fid, box);\r\n        return _ISelect.getTextO(obj);\r\n    }\r\n    static getTextO(obj: JQueryN): string {\r\n        if (_Obj.isEmpty(obj)) return '';\r\n        return obj!.find('option:selected').text();\r\n    }\r\n\r\n    //傳回data屬性(name)值\r\n    static getData(fid: string, name: string, box: JQuery): any {\r\n        return _Obj.get(fid, box)!.find('option:selected').data(name);\r\n    }\r\n    static getDataO(obj: JQueryN, name: string): any {\r\n        if (_Obj.isEmpty(obj)) return null;\r\n        return obj!.find('option:selected').data(name);\r\n    }\r\n\r\n    //重新設定option內容\r\n    //items: 來源array, 欄位為:Id,Str\r\n    static setItems(fid: string, items: { Id: string, Str: string }[] | null, box: JQuery): void {\r\n        const obj = _Obj.get(fid, box);\r\n        _ISelect.setItemsO(obj, items);\r\n    }\r\n    static setItemsF(filter: string, items: { Id: string, Str: string }[] | null, box: JQuery): void {\r\n        const obj = _Obj.getF(filter, box);\r\n        _ISelect.setItemsO(obj, items);\r\n    }\r\n    //by object\r\n    static setItemsO(obj: JQueryN, items: { Id: string, Str: string }[] | null): void {\r\n        if (_Obj.isEmpty(obj)) return;\r\n\r\n        obj!.find('option').remove();\r\n        if (items === null)\r\n            return;\r\n\r\n        for (let i = 0; i < items.length; i++)\r\n            obj!.append($('<option></option>').attr('value', items[i].Id).text(items[i].Str));\r\n    }\r\n\r\n    //get all options\r\n    //getIdStrExts -> getExts\r\n    static getExts(fid: string, box: JQuery): { Id: string, Str: string, Ext: string }[] {\r\n        const rows: { Id: string, Str: string, Ext: string }[] = [];\r\n        _Obj.get(fid, box)!.find('option').each(function (i) {\r\n            const me = $(this);\r\n            rows[i] = {\r\n                Id: me.val() as string,\r\n                Str: me.text(),\r\n                Ext: me.data('ext') as string,\r\n            };\r\n        });\r\n        return rows;\r\n    }\r\n\r\n    //重新設定option內容, 欄位為:Id,Str,Ext\r\n    //setItems2 -> setExts\r\n    static setExts(fid: string, items: { Id: string, Str: string, Ext: string }[] | null, box: JQuery): void {\r\n        const filter = '#' + fid;\r\n        const obj = box ? box.find(filter) : $(filter);\r\n        obj.find('option').remove();\r\n        if (items == null)\r\n            return;\r\n        for (let i = 0; i < items.length; i++)\r\n            obj.append(_Str.format(\"<option data-ext='{0}' value='{1}'>{2}</option>\", items[i].Ext, items[i].Id, items[i].Str));\r\n    }\r\n\r\n    //把多欄位值寫入json\r\n    //fids: 欄位名稱 array\r\n    static valuesToJson(json: { [key: string]: any }, fids: string[], box: JQuery): { [key: string]: any } {\r\n        for (let i = 0; i < fids.length; i++)\r\n            json[fids[i]] = _ISelect.get(fids[i], box);\r\n        return json;\r\n    }\r\n\r\n    //ie 不支援 option display:none !!\r\n    //filter options by data-ext value\r\n    //rows: 所有option 資料(Id,Text,Ext)\r\n    static filterByExt(fid: string, value: string, rows: { Id: string, Str: string, Ext: string }[], box: JQuery, allItem?: boolean, addEmptyStr?: string): void {\r\n        if (allItem === undefined)\r\n            allItem = false;\r\n        const obj = _Obj.get(fid, box);\r\n        obj!.empty();\r\n\r\n        if (addEmptyStr !== undefined && addEmptyStr !== '')\r\n            obj!.append(_Str.format('<option value=\"\">{0}</option>', addEmptyStr));\r\n\r\n        //item.find('option').hide();\r\n        const len = rows.length;\r\n        for (let i = 0; i < len; i++) {\r\n            const row = rows[i];\r\n            //if (row.Ext == value)\r\n            if ((allItem === true && row.Ext === '') || row.Ext === value)\r\n                obj!.append(_Str.format('<option value=\"{0}\">{1}</option>', row.Id, row.Str));\r\n        }\r\n\r\n        //選取第0筆\r\n        if (len > 0)\r\n            _ISelect.setIndexO(obj, 0);\r\n    }\r\n\r\n    /**\r\n     * ?? //todo\r\n     * onChangeParent -> changeParent\r\n     * 處理2個下拉欄位的連動, 例如:城市-鄉鎮, parent欄位改變時, child欄位的內容也改變\r\n     * param parentFid {stirng} parent欄位Id\r\n     * param childFid {stirng} child欄位Id\r\n     * param childId {stirng} child欄位值, 如果空白表示不設定此欄位值(只更新來源)\r\n     * param action {stirng} 後端action讀取來源, 固定傳入parentId\r\n     * param isEdit {bool} true(編輯畫面), false(查詢畫面)\r\n     */\r\n    static changeParent(parentFid: string, childFid: string, childId: string, action: string, isEdit: boolean): void {\r\n        // 假設 _me, _ajax 在其他地方有定義或引入，這裡因為原始程式碼沒有提供，所以需要根據實際情況調整\r\n        // 為了編譯通過，暫時將 _me.divEdit 和 _me.divRead 假設為 JQuery 類型\r\n        const _me: { divEdit: JQuery, divRead: JQuery } = { divEdit: $({}), divRead: $({}) }; // 模擬 _me 物件\r\n        const box = isEdit ? _me.divEdit : _me.divRead;\r\n        const thisId = _ISelect.get(parentFid, box);\r\n        _Ajax.getJsonA(action, { parentId: thisId }, (rows: { Id: string, Str: string }[]) => {\r\n            _ISelect.setItems(childFid, rows, box);\r\n            if (_Str.notEmpty(childId)) {\r\n                _ISelect.set(childFid, childId, box);\r\n            }\r\n        });\r\n    }\r\n\r\n} //class"]}