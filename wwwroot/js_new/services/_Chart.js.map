{"version":3,"file":"_Chart.js","sourceRoot":"","sources":["../../../services/_Chart.ts"],"names":[],"mappings":"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","sourcesContent":["import { Chart } from \"chart.js\";\r\n\r\n// 這行很重要：要先註冊所有內建組件\r\n//Chart.register(...registerables);\r\n\r\n// 假設的依賴靜態類別\r\nimport _Json from \"./_Json\";\r\n// 假設 Chart 來自 Chart.js 函式庫，且其類型已定義\r\n\r\n// type definition for Chart DTOs (simplified)\r\ninterface ChartDataDto {\r\n    labels: string[];\r\n    values: number[]; // For single dataset charts\r\n    title?: string;\r\n    options?: any;\r\n    // For group charts, it should contain datasets: any[]\r\n    datasets?: any[]; \r\n}\r\n\r\n/**\r\n * Chart.js utility class\r\n */\r\nexport default class _Chart {\r\n\r\n    //_nowChart: any = null; // 註解掉的屬性\r\n\r\n    //彩虹顏色\r\n    static readonly rainbowColors: string[] = [\r\n        \"#F32E37\",\r\n        \"#EABE37\",\r\n        \"#89E926\",\r\n        \"#22E352\",\r\n        \"#2FE5E8\",\r\n        \"#295AE7\",\r\n        \"#8828EE\",\r\n        \"#E629B7\",\r\n    ];\r\n\r\n    /**\r\n     * show one line chart\r\n     * param divId {string}\r\n     * param rows {List<IdNumDto>}\r\n     * param color {string} \r\n     */\r\n    /*\r\n    static line(canvasId: string, rows: { Id: string, Num: number }[], color: string): void {\r\n        const ids: string[] = [];\r\n        const values: number[] = [];\r\n        for (let i = 0; i < rows.length; i++) {\r\n            const row = rows[i];\r\n            ids[i] = row.Id;\r\n            values[i] = row.Num;\r\n        }\r\n        _Chart.drawLine(canvasId, ids, values, color);\r\n    }\r\n\r\n    private static _clear(): void {\r\n        if (_Chart._nowChart != null)\r\n            _Chart._nowChart.destroy();\r\n    }\r\n    */\r\n\r\n    /**\r\n     * show chart (private implementation)\r\n     * param type {string} bar/pie/line/hbar\r\n     * param canvasObj {HTMLCanvasElement} canvas Object (or JQuery object that wraps it)\r\n     * param dto {ChartDataDto} Chart/ChartGroup model, 可加入 config, 屬性datasets -> values !! \r\n     * param legend {boolean} show legend or not, default true\r\n     * param percent {boolean} show percentage(for pie,doughnut) or not, default false\r\n     * return {any} Chart object\r\n     */\r\n    private static _show(type: string, canvasObj: any, dto: ChartDataDto, legend?: boolean | null, percent?: boolean | null): any {\r\n        if (legend == null)\r\n            legend = true;\r\n        if (percent == null)\r\n            percent = false;\r\n\r\n        //default config\r\n        const isHbar = (type === 'hbar');\r\n        let config: any = {\r\n            type: isHbar ? 'bar' : type,\r\n            data: {\r\n                labels: dto.labels,\r\n                /*\r\n                datasets: dto.values,\r\n                */\r\n                datasets: dto.datasets ? dto.datasets : [\r\n                    {\r\n                        //label: \"Population (millions)\",\r\n                        //backgroundColor: [\"#3e95cd\", \"#8e5ea2\", \"#3cba9f\", \"#e8c3b9\", \"#c45850\"],\r\n                        data: dto.values,\r\n                    }\r\n                ]\r\n            },\r\n            options: {\r\n                //多包一層plugins才能顯示title\r\n                plugins: {\r\n                    legend: {\r\n                        position: 'bottom',\r\n                        display: legend,\r\n                    },\r\n                    animation: {\r\n                        animateScale: true,\r\n                        animateRotate: true\r\n                    },\r\n                    title: {\r\n                        display: true,\r\n                        text: dto.title,\r\n                        //class: 'xc-title',    //3.x以後不支持\r\n                        font: {\r\n                            size: 16,    //temp add\r\n                        },\r\n                    }\r\n                }\r\n            }\r\n        };\r\n\r\n        //add ext config.options if any\r\n        if (dto.options != null) {\r\n            // 假設 _Json.copy 能夠正確地合併 JSON 物件\r\n            config.options = _Json.copy(dto.options, config.options);\r\n        }\r\n\r\n        //add percentage if need\r\n        if (percent) {\r\n            // 初始化 tooltip 結構\r\n            if (!config.options.plugins.tooltip) {\r\n                config.options.plugins.tooltip = { callbacks: {} };\r\n            }\r\n\r\n            config.options.plugins.tooltip.callbacks.label = function (ctx: any) {\r\n                //注意:不同版本的屬性不同, 以下為3.9.1版 !!\r\n                //get sum if need\r\n                const list = ctx.dataset.data;\r\n                if (ctx.chart._sum == null) {\r\n                    let sum = 0;\r\n                    // 使用 list.map 是為了遍歷，但更好的做法是用 reduce 或 for 迴圈\r\n                    // 這裡保持原始碼的 .map 寫法，但使用 for 迴圈更簡潔\r\n                    for (const num of list) {\r\n                        sum += num;\r\n                    }\r\n                    ctx.chart._sum = sum;\r\n                }\r\n\r\n                //save old label if need\r\n                if (ctx._oldLabel == null)\r\n                    ctx._oldLabel = ctx.label + ' ' + ctx.formattedValue;\r\n\r\n                //get percentage and add tail\r\n                const percentValue = (list[ctx.dataIndex] * 100 / ctx.chart._sum).toFixed(2) + \"%\";\r\n                return ctx._oldLabel + ' (' + percentValue + ')';\r\n            };\r\n        }\r\n\r\n        // 假設 Chart 類別已經定義\r\n        return new Chart(canvasObj, config);\r\n    }\r\n\r\n    //線形圖\r\n    static line(canvasObj: any, dto: ChartDataDto): any {\r\n        return _Chart._show('line', canvasObj, dto, false);\r\n    }\r\n\r\n    //水平條狀圖\r\n    static hbar(canvasObj: any, dto: ChartDataDto): any {\r\n        dto.options = {\r\n            indexAxis: 'y'\r\n        };\r\n        //debugger;\r\n        return _Chart._show('hbar', canvasObj, dto, false);\r\n    }\r\n\r\n    //圓餅圖\r\n    static pie(canvasObj: any, dto: ChartDataDto): any {\r\n        // null 傳入 _show 會使 legend 預設為 true (內建邏輯)\r\n        return _Chart._show('pie', canvasObj, dto, null, true);\r\n    }\r\n\r\n    //甜甜圈\r\n    static doughnut(canvasObj: any, dto: ChartDataDto): any {\r\n        return _Chart._show('doughnut', canvasObj, dto, null, true);\r\n    }\r\n\r\n    //多個線形圖\r\n    static groupLine(canvasObj: any, dto: ChartDataDto): any {\r\n        /*\r\n        //set curve line\r\n        dto.datasets.map(a => {\r\n            a.tension = 0;\r\n        });\r\n        */\r\n        return _Chart._show('line', canvasObj, dto);\r\n    }\r\n\r\n    //多個線形圖\r\n    static groupBar(canvasObj: any, dto: ChartDataDto): any {\r\n        return _Chart._show('bar', canvasObj, dto);\r\n    }\r\n\r\n    /**\r\n     * show one line chart, called Chart.js (舊版實作)\r\n     */ \r\n    static drawLine(canvasId: string, ids: string[], values: number[], color: string): any {\r\n        // _Chart._clear(); // 註解掉\r\n        // _Chart._nowChart = new Chart(...) // 註解掉\r\n        \r\n        // 假設 Chart 類別已經定義\r\n        return new Chart(document.getElementById(canvasId) as HTMLCanvasElement, {\r\n            type: 'line',\r\n            data: {\r\n                labels: ids,\r\n                datasets: [{\r\n                    //label: \"Africa\",\r\n                    data: values,\r\n                    borderColor: color,\r\n                    fill: false\r\n                }]\r\n            },\r\n            options: {\r\n                //legend: { display: false },\r\n                plugins: {\r\n                    legend: { display: false },\r\n                },\r\n                /*\r\n                title: {\r\n                    display: true,\r\n                    text: 'World population per region (in millions)'\r\n                }\r\n                */\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * initial datatable(use jquery datatables)\r\n     * param canvasObj {any} canvas Object\r\n     * param labels {string[]}\r\n     * param values {number[]}\r\n     * param colors {string[]}\r\n     * param config {any} custom config\r\n     * return {any} Chart\r\n     */\r\n    static initPie(canvasObj: any, labels: string[], values: number[], colors: string[], config?: any): any {\r\n\r\n        //default config\r\n        let config0: any = {\r\n            type: 'pie',\r\n            options: {\r\n                /*\r\n                layout: {\r\n                    padding: {\r\n                        left: 0,\r\n                        right: 0,\r\n                        top: 0,\r\n                        bottom: 0\r\n                    },\r\n                },\r\n                */\r\n                plugins: {\r\n                    legend: {\r\n                        position: 'right',\r\n                        //fullWidth: false,\r\n                        labels: {\r\n                            boxWidth: 10,\r\n                            //padding: 5,\r\n                        },\r\n                    },\r\n                }\r\n            },\r\n            data: {\r\n                labels: labels, // 標題\r\n                datasets: [{\r\n                    //label: \"# of Votes\", // 標籤\r\n                    data: values, // 資料\r\n                    backgroundColor: colors,\r\n                    borderWidth: 1 // 外框寬度\r\n                }]\r\n            },\r\n        };\r\n\r\n        //加入外部傳入的自定義組態\r\n        if (config)\r\n            // 假設 _Json.copy 能夠正確地合併 JSON 物件\r\n            config0 = _Json.copy(config, config0);\r\n        \r\n        // 假設 Chart 類別已經定義\r\n        return new Chart(canvasObj, config0);\r\n    }\r\n\r\n}"]}